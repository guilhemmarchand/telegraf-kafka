<form stylesheet="telegraf-kafka:common.css" hideEdit="True" isVisible="True">
    <label>Kafka Connect - Entity health view</label>

    <search id="connect_state_summary">
        <query>| mstats latest(_value) as value WHERE `telegraf_kafka_index` metric_name="kafka_connect.worker.task-startup-failure-total" OR metric_name="kafka_connect.worker.connector-startup-failure-total" OR metric_name="kafka_connect.worker.time-since-last-rebalance-ms" OR metric_name="kafka_connect.worker.task-count" $env$ $label$ $jolokia_agent_url$ by metric_name, jolokia_agent_url
| eval {metric_name}=value
| stats first(kafka_connect.*) as "*" by jolokia_agent_url
| stats min(worker.time-since-last-rebalance-ms) as worker.time-since-last-rebalance-ms, sum(*) as "*"
| eval duration=tostring(round('worker.time-since-last-rebalance-ms'/1000, 0), "duration")
| fields worker.connector-startup-failure-total, worker.task-startup-failure-total, worker.task-count, duration</query>
        <earliest>-90s</earliest>
        <latest>now</latest>
        <refresh>30s</refresh>
        <refreshType>delay</refreshType>
    </search>

    <search id="connect_task_summary">
        <query>| mstats latest(_value) as value WHERE `telegraf_kafka_index` metric_name="kafka_connect.connector-task.status" OR metric_name="kafka_connect.connector-task.running-ratio" OR metric_name="kafka_connect.error-task.total-errors-logged" OR metric_name="kafka_connect.error-task.total-retries" $env$ $label$ $jolokia_agent_url$ by metric_name, env, label, jolokia_agent_url, connector, task
| eval {metric_name}=value
| stats min(kafka_connect.connector-task.status) as connector-task.status, first(kafka_connect.*) as "*" by env, label, jolokia_agent_url, connector, task
| eval connector-task.running-ratio=round('connector-task.running-ratio'*100, 2)
| fields env, label, jolokia_agent_url, connector, task, connector-task.status
| rename connector-task.status as integer_status
| eval status=case(integer_status=0, "paused", integer_status=1, "running", integer_status=2, "unassigned", integer_status=3, "failed", integer_status=4, "destroyed")
| stats first(*) as "*", values(task) as task, list(status) as status by env, label, jolokia_agent_url, connector
| join env, label, jolokia_agent_url, connector [ | mcatalog values(metric_name) as metric_name where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-poll-total" OR metric_name="kafka_connect.sink-task.sink-record-read-total" connector=* by env, label, jolokia_agent_url, connector
| eval role=case(match(metric_name, "sink-task"), "kafka_sink_task", match(metric_name, "source-task"), "kafka_source_task")
| fields env, label, jolokia_agent_url, connector, role ]
| fields env, label, jolokia_agent_url, connector, role, task, status</query>
        <earliest>-90s</earliest>
        <latest>now</latest>
        <refresh>30s</refresh>
        <refreshType>delay</refreshType>
    </search>

    <search id="main_populate">
        <query>| savedsearch telegraf-kafka-kafka-connect-workers</query>
        <earliest>$earliest$</earliest>
        <latest>$latest$</latest>
    </search>

    <fieldset autoRun="false" submitButton="false">
        <input type="time" searchWhenChanged="true">
            <label></label>
            <default>
                <earliestTime>-4h</earliestTime>
                <latestTime>now</latestTime>
            </default>
        </input>
        <input type="multiselect" token="env" searchWhenChanged="true">
            <label>Env:</label>
            <!-- Populating Data Model Search -->
            <search base="main_populate">
                <query>dedup env | sort 0 env</query>
            </search>
            <valuePrefix>env="</valuePrefix>
            <valueSuffix>"</valueSuffix>
            <delimiter> OR </delimiter>
            <choice value="*">ANY</choice>
            <initialValue>*</initialValue>
            <fieldForLabel>env</fieldForLabel>
            <fieldForValue>env</fieldForValue>
        </input>
        <input type="multiselect" token="label" searchWhenChanged="true">
            <label>Label:</label>
            <!-- Populating Data Model Search -->
            <search base="main_populate">
                <query>search $env$ | dedup label | sort 0 label</query>
            </search>
            <valuePrefix>label="</valuePrefix>
            <valueSuffix>"</valueSuffix>
            <delimiter> OR </delimiter>
            <choice value="*">ANY</choice>
            <initialValue>*</initialValue>
            <fieldForLabel>label</fieldForLabel>
            <fieldForValue>label</fieldForValue>
        </input>
        <input type="multiselect" token="jolokia_agent_url" searchWhenChanged="true">
            <label>Kafka connnect worker(s):</label>
            <!-- Populating Data Model Search -->
            <search base="main_populate">
                <query>search $env$ $label$ | dedup jolokia_agent_url | sort jolokia_agent_url</query>
            </search>
            <valuePrefix>jolokia_agent_url="</valuePrefix>
            <valueSuffix>"</valueSuffix>
            <delimiter> OR </delimiter>
            <choice value="*">ANY</choice>
            <fieldForLabel>jolokia_agent_url</fieldForLabel>
            <fieldForValue>jolokia_agent_url</fieldForValue>
        </input>
    </fieldset>

    <row>
        <panel>
            <single>
                <search base="connect_state_summary">
                    <query>fields worker.connector-startup-failure-total</query>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">FAILED WORKER STARTUP</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <single>
                <search base="connect_state_summary">
                    <query>fields worker.task-startup-failure-total</query>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">FAILED TASKS STARTUP</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <single>
                <search base="connect_state_summary">
                    <query>fields duration</query>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="numberPrecision">0.00</option>
                <option name="rangeColors">["0x006d9c","0x006d9c"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">DURATION SINCE LAST REBALANCE</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <single>
                <search base="connect_task_summary">
                    <query>stats dc(connector) as connector</query>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="numberPrecision">0</option>
                <option name="rangeColors">["0x006d9c","0x006d9c"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">CONNECTOR(S) DISTINCT COUNT</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <single>
                <search base="connect_task_summary">
                    <query>stats count(task) as count</query>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="numberPrecision">0</option>
                <option name="rangeColors">["0x006d9c","0x006d9c"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">TOTAL TASK(S) COUNT</option>
                <option name="useColors">1</option>
            </single>
        </panel>
    </row>

    <row>
        <panel>
            <input type="link" token="top_linkinput">
                <label></label>
                <choice value="chart1">CONNECT ACTIVITY OVERVIEW</choice>
                <choice value="chart2">CONNECTOR TASKS</choice>
                <choice value="chart3">SOURCE TASKS</choice>
                <choice value="chart4">SINK TASKS</choice>
                <choice value="chart5">ERROR TASKS</choice>
                <choice value="chart6">TABLE CONNECTORS/TASKS</choice>
                <choice value="chart7">LOGS ACTIVITY</choice>
                <default>chart1</default>
                <change>
                    <condition value="chart1">
                        <set token="chart1">true</set>
                        <unset token="chart2"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart6"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart2">
                        <set token="chart2">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart6"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart3">
                        <set token="chart3">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart2"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart6"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart4">
                        <set token="chart4">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart2"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart6"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart5">
                        <set token="chart5">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart2"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart6"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart6">
                        <set token="chart6">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart2"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart7"></unset>
                    </condition>
                    <condition value="chart7">
                        <set token="chart7">true</set>
                        <unset token="chart1"></unset>
                        <unset token="chart2"></unset>
                        <unset token="chart3"></unset>
                        <unset token="chart4"></unset>
                        <unset token="chart5"></unset>
                        <unset token="chart6"></unset>
                    </condition>
                </change>
            </input>
        </panel>
    </row>

    <row depends="$chart1$">
        <panel>
            <title>The number of tasks run in this worker</title>
            <chart>
                <search depends="$chart1$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.worker.task-count" $env$ $label$ $jolokia_agent_url$ by jolokia_agent_url span=10s
| timechart limit=20 useother=f`telegraf_kafka_span` avg(_value) as value by jolokia_agent_url</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Whether this worker is currently rebalancing</title>
            <chart>
                <search depends="$chart1$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.worker.rebalancing" $env$ $label$ $jolokia_agent_url$ by jolokia_agent_url span=10s
| timechart limit=20 useother=f `telegraf_kafka_span` avg(_value) as value by jolokia_agent_url</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart1$">
        <panel>
            <title>The average percentage of this worker's connectors starts that failed</title>
            <chart>
                <search depends="$chart1$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.worker.connector-startup-failure-percentage" $env$ $label$ $jolokia_agent_url$ by jolokia_agent_url span=10s
| timechart limit=20 useother=f `telegraf_kafka_span` avg(_value) as value by jolokia_agent_url</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The average percentage of this worker's tasks starts that failed</title>
            <chart>
                <search depends="$chart1$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.worker.task-startup-failure-percentage" $env$ $label$ $jolokia_agent_url$ by jolokia_agent_url span=10s
| timechart limit=20 useother=f `telegraf_kafka_span` avg(_value) as value by jolokia_agent_url</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart2$">
        <panel>
            <title>The fraction of time this task has spent in the running state</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.running-ratio" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The average size of the batches processed by the connector</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.batch-size-avg" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The maximum size of the batches processed by the connector</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.batch-size-max" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart2$">
        <panel>
            <title>The average percentage of this task's offset commit attempts that failed</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.offset-commit-success-percentage" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The average time in milliseconds taken by this task to commit offsets</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.offset-commit-avg-time-ms" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The maximum time in milliseconds taken by this task to commit offsets</title>
            <chart>
                <search depends="$chart2$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.connector-task.offset-commit-max-time-ms" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart3$">
        <panel>
            <title>Avg/sec records produced/polled (before transformation)</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-poll-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg time/ms taken to poll for a batch of source records</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.poll-batch-avg-time-ms" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Max time/ms taken by this task to poll for a batch of source records</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.poll-batch-max-time-ms" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart3$">
        <panel>
            <title>Avg/sec no records output from transformations written to Kafka, after transformations</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-write-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg no records that have been produced but not yet completely written to Kafka</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-active-count-avg" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Max no records that have been produced but not yet completely written to Kafka</title>
            <chart>
                <search depends="$chart3$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.source-task.source-record-active-count-max" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart4$">
        <panel>
            <title>Number of topic partitions assigned to this task</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.partition-count" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg/sec records read from Kafka, before transformations are applied</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.sink-record-read-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg/sec records output from transformations and sent/put, after transformations are applied</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.sink-record-send-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart4$">
        <panel>
            <title>Average time taken by this task to put a batch of sinks records</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.put-batch-avg-time-ms" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg/sec number of offset commit completions completed successfully</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.offset-commit-completion-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>Avg/sec number of offset commit completions received too late and skipped/ignored</title>
            <chart>
                <search depends="$chart4$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.sink-task.offset-commit-skip-rate" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart5$">
        <panel>
            <title>The number of errors that were logged</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.total-errors-logged" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The number of operations retried</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.total-retries" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The number of records skipped due to errors</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.total-records-skipped" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart5$">
        <panel>
            <title>The number of record processing failures in this task</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.total-record-failures" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The number of record processing errors in this task</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.total-record-errors" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <title>The number of attempted writes to the dead letter queue</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.deadletterqueue-produce-requests" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row depends="$chart5$">
        <panel>
            <title>The number of failed writes to the dead letter queue</title>
            <chart>
                <search depends="$chart5$">
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="kafka_connect.error-task.deadletterqueue-produce-failures" $env$ $label$ $jolokia_agent_url$ by connector span=10s
| timechart `telegraf_kafka_span` avg(_value) as avg useother=f limit=20 by connector</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
        </panel>
        <panel>
        </panel>
    </row>

    <row depends="$chart6$">
        <panel>
            <title>Connectors and tasks (realtime)</title>
            <table>
                <search base="connect_task_summary" depends="$chart6">
                    <query>sort 0 env, label, connector</query>
                </search>
            </table>
        </panel>
    </row>

    <row depends="$chart7$">
        <panel>
            <title>Kafka Connect log events by log_level</title>
            <chart>
                <search depends="$chart7$">
                    <query>eventtype="kafka_connect" log_level=* [ | savedsearch telegraf-kafka-kafka-connect-workers | search $jolokia_agent_url$ | table kafka_connect | rename kafka_connect as host ]
| timechart useother=f limit=0 minspan=1m count by log_level</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="charting.chart">column</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.fieldColors">{"ERROR": 0xff6961, "WARN": 0xffb347, "INFO": 0x779ecb, "DEBUG": 0xaec6cf, "TRACE": 0xb19cd9}</option>
            </chart>
        </panel>
    </row>
    <row depends="$chart7$">
        <panel>
            <title>Events</title>
            <input type="multiselect" token="log_sourcetype_tk" searchWhenChanged="true">
                <label>Sourcetypes:</label>
                <choice value="*">ANY</choice>
                <choice value="kafka:connect">kafka:connect</choice>
                <choice value="kafka:connect:gc-log">kafka:connect:gc-log</choice>
                <valuePrefix>sourcetype="</valuePrefix>
                <valueSuffix>"</valueSuffix>
                <delimiter> OR </delimiter>
                <initialValue>*</initialValue>
            </input>
            <input type="text" token="log_search_tk" searchWhenChanged="true">
                <label>Raw search:</label>
                <initialValue>*</initialValue>
            </input>
            <event>
                <search depends="$chart7$">
                    <query>eventtype="kafka_connect" $log_search_tk$ $log_sourcetype_tk$ [ | savedsearch telegraf-kafka-kafka-connect-workers | search $jolokia_agent_url$ | table kafka_connect | rename kafka_connect as host ]</query>
                    <earliest>$earliest$</earliest>
                    <latest>$latest$</latest>
                    <sampleRatio>1</sampleRatio>
                </search>
                <option name="count">10</option>
                <option name="list.drilldown">none</option>
                <option name="list.wrap">1</option>
                <option name="maxLines">5</option>
                <option name="raw.drilldown">none</option>
                <option name="rowNumbers">0</option>
                <option name="table.drilldown">none</option>
                <option name="table.sortDirection">asc</option>
                <option name="table.wrap">1</option>
                <option name="type">list</option>
            </event>
        </panel>
    </row>
</form>