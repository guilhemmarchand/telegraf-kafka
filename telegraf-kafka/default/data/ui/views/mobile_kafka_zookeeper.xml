<form hideEdit="False" isVisible="True" theme="dark">
    <label>Kafka Zookeeper - Health</label>
    <fieldset submitButton="false">
    </fieldset>

    <row>
        <panel>
            <title>Number of active nodes</title>
            <single>
                <search>
                    <query>| mcatalog values(metric_name) as metric_name where `telegraf_kafka_index` metric_name="zookeeper.avg_latency" OR metric_name="zookeeper.open_file_descriptor_count" env=* label=* by env, label, server | stats count</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">all</option>
                <option name="numberPrecision">0</option>
                <option name="rangeColors">["0x006d9c","0x006d9c"]</option>
                <option name="rangeValues">[0]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">ZOOKEEPER SERVER</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>Latency</title>
            <single>
                <search>
                    <query>| mstats avg(_value) as value where `telegraf_kafka_index` metric_name="zookeeper.avg_latency" env=* label=*</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="numberPrecision">0.00</option>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
                <option name="rangeValues">[10]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">AVERAGE LATENCY (millisecond)</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>Outstanding requests</title>
            <single>
                <search>
                    <query>| mstats avg(_value) as value where `telegraf_kafka_index` metric_name="zookeeper.outstanding_requests" env=* label=*</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="colorMode">block</option>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0xdc4e41"]</option>
                <option name="rangeValues">[10]</option>
                <option name="refresh.display">progressbar</option>
                <option name="underLabel">OUTSTANDING REQUESTS</option>
                <option name="useColors">1</option>
            </single>
        </panel>
    </row>

    <row>
        <panel>
            <chart>
                <title>Average latency (millisecond)</title>
                <search>
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="zookeeper.avg_latency" env=* label=* by server span=1s
| timechart span=5m avg(_value) as "Avg" by server</query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Outstanding requests</title>
                <search>
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="zookeeper.outstanding_requests" env=* label=* by server span=1s
| timechart span=5m avg(_value) as "Avg" by server</query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Pending Sync</title>
                <search>
                    <query>| mstats avg(_value) prestats=true where `telegraf_kafka_index` metric_name="zookeeper.pending_syncs" env=* label=* by server span=1s
| timechart span=5m avg(_value) as "Avg" by server</query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

    <row>
        <panel>
            <table>
                <title>File descriptor percentage used</title>
                <search>
                    <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="zookeeper.max_file_descriptor_count" OR metric_name="zookeeper.open_file_descriptor_count" env=* label=* by metric_name, server
| eval {metric_name}=value
| stats first(zookeeper.*) as "*" by server
| eval percent_used=round((open_file_descriptor_count/max_file_descriptor_count)*100, 3)
| fields server, percent_used</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
        <panel>
            <chart>
                <title>Packets received</title>
                <search>
                    <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="zookeeper.packets_received" env=* label=* by metric_name, server span=1s
| eval {metric_name}=value
| stats first(zookeeper.*) as "*_counter" by _time, server
| streamstats current=f last(*_counter) as "*_prev" by server
| eval packets_received=(packets_received_counter-packets_received_prev)
| fields _time, server, packets_received
| where packets_received&gt;=0
| timechart span=5m avg(packets_received) as packets_received by server</query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
        <panel>
            <chart>
                <title>Packets sent</title>
                <search>
                    <query>| mstats latest(_value) as value where `telegraf_kafka_index` metric_name="zookeeper.packets_sent" env=* label=* by metric_name, server span=1s
| eval {metric_name}=value
| stats first(zookeeper.*) as "*_counter" by _time, server
| streamstats current=f last(*_counter) as "*_prev" by server
| eval packets_sent=(packets_sent_counter-packets_sent_prev)
| fields _time, server, packets_sent
| where packets_sent&gt;=0
| timechart span=5m avg(packets_sent) as packets_sent by server</query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <sampleRatio>1</sampleRatio>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.visibility">collapsed</option>
                <option name="charting.chart.nullValueMode">gaps</option>
                <option name="charting.chart.showDataLabels">none</option>
                <option name="charting.legend.placement">top</option>
                <option name="charting.drilldown">all</option>
            </chart>
        </panel>
    </row>

</form>